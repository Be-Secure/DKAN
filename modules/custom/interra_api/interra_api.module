<?php

use Drupal\node\Entity\Node;

/**
 * Gets "routes" which is an array of the active collections with uuids and paths.
 *
 * @return array()
 *   Active collections. Each collection contains an array of uuids => paths.
 */
function getRoutes() {
  $collections = getCollections();
  $nodes = array();
  $output = array();
  foreach ($collections as $collection) {
    $nodes[$collection] = getNodesByType($collection);
  }
  foreach ($nodes as $type => $items) {
    foreach ($items as $node) {
      $uid = $node->uuid();
      $alias = \Drupal::service('path.alias_manager')->getAliasByPath('/node/'. $node->id());
      $path =  ltrim($alias, '/');
      array_push($output[$type] = array($uid => $path));

    }
  }
  return $output;
}

/**
 * Gets the collections defined by the current schema. TODO: don't hardcode.
 *
 * @return array()
 *   Active collections.
 */
function getCollections() {
  return array(
    'dataset',
    'organization',
  );
}

/**
 * Returns all nodes by content type.
 */
function getNodesByType($type) {
  $nids = \Drupal::entityQuery('node')
    ->condition('status', 1)
    ->condition('type', $type)
    ->execute();
  $nodes = Node::loadMultiple($nids);
  return $nodes;
}
